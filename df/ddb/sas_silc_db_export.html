<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PING: silc_db_export</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../ping_bw.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PING
   &#160;<span id="projectnumber">0.9</span>
   </div>
   <div id="projectbrief">Statistical data handling and processing in production environment</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('df/ddb/sas_silc_db_export.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">silc_db_export </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Export EU-SILC bulk datasets from SAS format (<code>.sas7bdat</code>) to any format supported by <code>PROC FORMAT</code>.</p>
<div class="fragment"><div class="line">%silc_db_export(survey, time, geo=, db=, src=, _ds_=, _path_=, </div><div class="line">                cds_transxyear=META_TRANSMISSIONxYEAR, clib=LIBCFG);</div></div><!-- fragment --><h3>Arguments</h3>
<ul>
<li><code>survey</code> : type of the survey; this is represented by any of the character values defined in the global variable <code>G_PING_SURVEYTYPES</code>, <em>i.e.</em> as:<ul>
<li><code>X</code>. <code>C</code> or <code>CROSS</code> for a cross-sectional survey,</li>
<li><code>L</code> or <code>LONG</code> for a longitudinal survey,</li>
<li><code>E</code> or <code>EARLY</code> for an early survey,</li>
</ul>
</li>
<li><code>time</code> : a single selected year of interest;</li>
<li><code>geo</code> : string(s) representing the ISO-code(s) of (a) country(ies); note that when <code>geo</code>is not passed and <code>src=raw</code> (see below), the output parameters <code>_path_</code> and <code>_ds_</code> cannot be defined: only <code>_ftyp_</code> can be returned (see below); in all other cases, <code>geo</code> is ignored;</li>
<li><code>db</code> : (<em>option</em>) database(s) to retrieve; it can be any of the character values defined through the global variable <code>G_PING_BASETYPES</code>, <em>i.e.</em>:<ul>
<li><code>D</code> for household register/D file,</li>
<li><code>H</code> for household/H file,</li>
<li><code>P</code> for personal register/P file,</li>
<li><code>R</code> for register/R file, so as to represent the corresponding bulk databases (files); by default,<code>db=&amp;G_PING_BASETYPES</code>;</li>
</ul>
</li>
<li><code>src</code> : (<em>option</em>) string defining the source location where to look for bulk database; this can be either the full path of the directory where to search in, or any of the following strings:<ul>
<li><code>bdb</code>, ibid with the value of <code>G_PING_BDB</code>,</li>
<li><code>pdb</code>, ibid with the value of <code>G_PING_PDB</code>,</li>
<li><code>idb</code>, ibid with the value of <code>G_PING_IDB</code>,</li>
<li><code>udb</code>, ibid with the value of <code>G_PING_UDB</code>; note that the latter four cases are independent of the parameter chosen for <code>geo</code>; note also that <code>src=bdb</code> and <code>src=idb</code> are incompatible with <code>survey&lt;&gt;X</code>; furthermore, when <code>src=idb</code>, the parameter <code>db</code> is ignored; by default, <code>src</code> is set to the value of <code>G_PING_RAWDB</code> (<em>e.g.</em> <code>&amp;G_PING_ROOTPATH/main</code>) so as to look for raw data;</li>
</ul>
</li>
<li><code>cds_transxyear, clib</code> : (<em>options</em>) configuration file storing the the yearly definition of microdata transmission files' format, and library where it is actually stored; for further description of the table, see <a class="el" href="../../d0/d46/meta_transmissionxyear.html">%meta_transmissionxyear</a> and <a class="el" href="../../de/dfa/sas_silc_db_locate.html">%silc_db_locate</a>.</li>
</ul>
<h3>Returns</h3>
<ul>
<li><code>_ofn_</code> : name (string) of the macro variable storing the output exported file name.</li>
<li><code>odir</code> : (<em>option</em>) output directory/library to store the converted dataset; by default, it is set to:<ul>
<li>the location of your project if you are using SAS EG (see <a class="el" href="../../d6/d47/sas__egp_path.html">%_egp_path</a>),</li>
<li>the path of <code>sysget(SAS_EXECFILEPATH)</code> if you are running on a Windows server,</li>
<li>the location of the library passed through <code>ilib</code> (<em>i.e.</em>, <code>sysfunc(pathname(&amp;ilib))</code>) otherwise.</li>
</ul>
</li>
</ul>
<h2>Example</h2>
<p>Let us export some bulk datasets from the so-called BDB into <code>Stata</code> native format (<code>dta</code>):</p>
<div class="fragment"><div class="line">%let survey=CROSS;</div><div class="line">%let time=2015;</div><div class="line">%let src=BDB;</div><div class="line">%let db=D H R;</div><div class="line">%let fmt=dta;</div><div class="line">%let odir=&amp;G_PING_ROOTPATH;</div><div class="line">%silc_db_export(CROSS, 2015, odir=&amp;odir, _ofn_=ofn, fmt=&amp;fmt, db=&amp;db, src=&amp;src);</div></div><!-- fragment --><p>In our current environment (see <code>G_PING_ROOTPATH</code> definition), the following output files will be created:</p><ul>
<li>0eusilc/bdb_c15d.dta</li>
<li>0eusilc/bdb_c15h.dta</li>
<li>0eusilc/bdb_c15r.dta</li>
</ul>
<h3>See also</h3>
<p><a class="el" href="../../d1/db0/sas_silc_ds_extract.html">%silc_ds_extract</a>, <a class="el" href="../../de/dfa/sas_silc_db_locate.html">%silc_db_locate</a>, <a class="el" href="../../da/d8c/sas_ds_export.html">%ds_export</a>, <a class="el" href="../../d0/d46/meta_transmissionxyear.html">%meta_transmissionxyear</a>. **/</p>
<p>/* credits: gjacopo */</p>
<p>macro silc_db_export(survey /* Input type of the survey (REQ) */ , time /* Input year under consideration (REQ) */ , geo= /* Input country under consideration (REQ) */ , odir= /* Full path of output directory (OPT) */ , <em>ofn</em>= /* Name of the variable storing the output filename (OPT) */ , fmt= /* Format of import (OPT) */ , db= /* Input database to retrieve (OPT) */ , src= /* Input location of bulk data source (OPT) */ , cds_transxyear= /* Name of configuration file storing the type of transmission files (OPT) */ , clib= /* Name of the configuration library (OPT) */ ); local _mac; let _mac= macro_put(&amp;_mac);</p>
<p>/************************************************************************************/ /** checkings/settings **/ /************************************************************************************/</p>
<p>local YEARINIT;</p>
<p>/* GEO: check/set input ISO-code</p><ul>
<li>DB: check the bulk database definition</li>
<li>SURVEY: check/reset the survey type</li>
<li>SRC/DIR: check/set input directory</li>
<li>the default settings + basic checkings are made in silc_db_locate below */</li>
</ul>
<p>/* TIME: check/set */ if symexist(G_PING_INITIAL_YEAR) then let YEARINIT= else let YEARINIT=2002;</p>
<p>if error_handle(ErrorInputParameter, par_check(&amp;time, type=INTEGER, range=&amp;YEARINIT) NE 0, mac=&amp;_mac, txt=quote(!!! Wrong type/value for input TIME !!!)) then goto exit; else let yy=substr(&amp;time,3,2);</p>
<p>/* ODIR: default setting and checking odir */ if macro_isblank(odir) then do; if symexist(_SASSERVERNAME) then /* working with SAS EG */ let odir=&amp;G_PING_ROOTPATH/_egp_path(path=drive); else if &amp;sysscp = WIN then do; /* working on Windows server */ let odir=sysget(SAS_EXECFILEPATH); if not macro_isblank(odir) then let odir=qsubstr(&amp;odir, 1, length(&amp;odir)-length(sysget(SAS_EXECFILENAME)); end; end; if error_handle(ErrorInputParameter, macro_isblank(odir) EQ 1, mac=&amp;_mac, txt=quote(!!! Output directory upcase(&amp;odir) not set !!!)) or error_handle(ErrorInputParameter, dir_check(&amp;odir) NE 0, mac=&amp;_mac, txt=quote(!!! Output directory upcase(&amp;odir) does not exist !!!)) then goto exit;</p>
<p>/* FMT */ if macro_isblank(fmt) then let fmt=csv;</p>
<p>/************************************************************************************/ /** actual computation **/ /************************************************************************************/</p>
<p>local _i _ofn ds path SEP; let SEP=quote( ); let _ofn=;</p>
<p>silc_db_locate(&amp;survey, &amp;time, geo=&amp;geo, db=&amp;db, src=&amp;src, <em>ds</em>=ds, <em>path</em>=path, cds_transxyear=&amp;cds_transxyear, clib=&amp;clib, lazy=YES);</p>
<p>if not macro_isblank(<em>ofn</em>) then let &amp;_ofn_=;</p>
<p>do <em>i=1 to list_length(&amp;ds); libname tmplib "%scan(&amp;path,&amp;_i, &amp;SEP)"; let idsn=scan(&amp;ds, &amp;_i); ds_export(&amp;idsn, odir=&amp;odir, _ofn</em>=_ofn, fmt=&amp;fmt, ilib=tmplib); libname tmplib clear; if not macro_isblank(<em>ofn</em>) then let &amp;_ofn_=&amp;&amp;&amp;_ofn_  end;</p>
<p>exit: mend silc_db_export;</p>
<p>macro <em>example_silc_db_export; if symexist(G_PING_SETUPPATH) EQ 0 then do; if symexist(G_PING_ROOTPATH) EQ 0 then do; put WARNING: !!! PING environment not set - Impossible to run &amp;sysmacroname !!!; put WARNING: !!! Set global variable G_PING_ROOTPATH to your PING install path !!!; goto exit; end; else do; let G_PING_PROJECT= 0EUSILC; let G_PING_SETUPPATH=&amp;G_PING_ROOTPATH./PING; let G_PING_DATABASE= /ec/prod/server/sas/0eusilc; include "&amp;G_PING_SETUPPATH/library/autoexec/_eusilc_setup&lt;/em&gt;.sas"; _default_setup_; end; end;</em></p>
<p><em> local _i survey time src ofn odir fmt db; let ofn=;</em></p>
<p><em> /* we currently launch this example in the highest level (1) of debug only */ if symexist(G_PING_DEBUG) then let olddebug= else do; global G_PING_DEBUG; let olddebug=0; end; let G_PING_DEBUG=1;</em></p>
<p><em> let survey=CROSS; let time=2015; let src=BDB; let db=D H R; let fmt=dta; let odir=/ec/prod/server/sas/0eusilc; put Given the following parameters:; put - survey= put - time= put - src= put - db= put - fmt= put - odir= silc_db_export(&amp;survey, &amp;time, odir=&amp;odir, <em>ofn</em>=ofn, fmt=dta, db=&amp;db, src=&amp;src); put the following output files will be created:; do _i=1 to list_length(&amp;ofn); put - scan(&amp;ofn, &amp;_i, quote( )); end;</em></p>
<p><em> /* reset the debug as it was (if it ever was set) */ let G_PING_DEBUG=</em></p>
<p><em> put;</em></p>
<p><em> exit: mend _example_silc_db_export;</em></p>
<p><em>/* Uncomment for quick testing options NOSOURCE MRECALL MLOGIC MPRINT NOTES; _example_silc_db_export; </em></p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d6/da4/_integration.html">5.1 Integration</a></li>
    <li class="footer">Generated on Fri Jan 12 2018 09:15:49 for PING by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
